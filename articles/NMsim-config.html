<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Requirements and Configuration • NMsim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Requirements and Configuration">
<meta name="google-site-verification" content="-8n-8OfzJii_lVruWfxXOhzUATKSgMdiSxMhOQoscu4">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NMsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/NMsim-intro.html">NMsim Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-VPC.html">Simulations for VPCs</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-config.html">Requirements and Configuration</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-known.html">Simulate Known Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ParamUncertain.html">Simulations with Parameter Uncertainty</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-forest.html">Simulation-based forest plots with NMsim</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-DataCreate.html">Data Set Creation with NMsim</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ResidVar.html">Simulation with Residual Variability</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-varyPars.html">Simulate Models with Modifications</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ReuseSimSubjects.html">Reuse Simulated Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-speed.html">Debugging, Speed, and Disk Space</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/NMsim-publications.html">Publications</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NMautoverse/NMsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NMautoverse/NMsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Requirements and Configuration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NMautoverse/NMsim/blob/main/vignettes/NMsim-config.Rmd" class="external-link"><code>vignettes/NMsim-config.Rmd</code></a></small>
      <div class="d-none name"><code>NMsim-config.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="objectives">Objectives<a class="anchor" aria-label="anchor" href="#objectives"></a>
</h2>
<p>This vignettes aims at enabling you to</p>
<ul>
<li><p>Understand requirements for using NMsim</p></li>
<li><p>Configure <code>NMsim</code> to use <code>PSN</code> or methods
provided by <code>NMsim</code> to update Nonmem control stream initial
values and to run Nonmem</p></li>
<li><p>Understand pros and cons of using <code>PSN</code> vs. methods
provided by <code>NMsim</code>.</p></li>
<li><p>Configure <code>NMsim</code> to store results in desired
locations and separate storage of temporary files and storage of
selected and efficiently stored key result data.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h2>
<p><code>NMsim</code> itself and many features will work in any newer R
installation. For a seamless simulation experience within R, Nonmem
installations on linux, Windows and Mac are supported. Multi-threaded
execution may currently not work on Windows.</p>
<p><code>NMsim</code> relies on Nonmem for running simulations. For a
fully seamless simulation experience within R, NMsim must be able to
execute Nonmem. The simplest example where this is easily achieved, is
when R and Nonmem run on the same system. If they are on separate
systems, the questions are: Do R and Nonmem share access to a data
structure where the relevant files can be stored and executed? And can R
login to that other system to run Nonmem, for instance through SSH? In
case these two criteria are met, the fully seamless experience should
still be possible.</p>
<p>If your system does not meet these requirements, it does not mean
that NMsim can’t work. It can still put together your Nonmem simulation
control streams and data and make everything ready for Nonmem to
execute. Once you have run Nonmem, you can then use
<code><a href="../reference/NMreadSim.html">NMsim::NMreadSim()</a></code> to collect the results.</p>
</div>
<div class="section level2">
<h2 id="configuration-of-nmsim">Configuration of NMsim<a class="anchor" aria-label="anchor" href="#configuration-of-nmsim"></a>
</h2>
<p>Below this section, some background discussion is provided to
understand which methods to choose. No matter what you prefer to use,
the best is to set up <code>NMsim</code> to be able to use both Nonmem
and (if available) PSN. Then you have the flexibility to switch between
methods as preferred.</p>
<div class="section level3">
<h3 id="specify-the-nonmem-paths">Specify the Nonmem paths<a class="anchor" aria-label="anchor" href="#specify-the-nonmem-paths"></a>
</h3>
<p>For <code>NMsim</code> to run Nonmem, it needs to know where to find
the Nonmem executable. This step is recommended.</p>
<p>The easiest way to configure this is through NMdata’s configuration
function. Say you want to run Nonmem with
<code>/opt/NONMEM/nm75/run/nmfe</code>, insert this after loading
<code>NMdata</code> in the beginning of your script</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/NMdataConf.html" class="external-link">NMdataConf</a></span><span class="op">(</span>path.nonmem<span class="op">=</span><span class="st">"/opt/NONMEM/nm75/run/nmfe75"</span><span class="op">)</span></span></code></pre></div>
<p>On Windows, the executable has a <code>.bat</code> extension. The
path could look be</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/NMdataConf.html" class="external-link">NMdataConf</a></span><span class="op">(</span>path.nonmem <span class="op">=</span><span class="st">"C:/nm75g64/run/nmfe75.bat"</span><span class="op">)</span></span></code></pre></div>
<p>If you normally use PSN as your Nonmem interface, and you do not know
where Nonmem is installed, you can check this using PSN. The following
command should give you the Nonmem installation paths that PSN is
configured with. However, you likely still need to add the last piece of
the path from the installation directory to the nonmem binary.</p>
<pre><code><span><span class="va">psn</span> <span class="op">-</span><span class="va">nm_versions</span></span></code></pre>
<p>If you need to execute scripts on systems with different Nonmem
installation paths, you can select between a prioritized set of paths
like this, taking the first one found:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paths.nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"/opt/NONMEM/nm75/run/nmfe75"</span>,</span>
<span>              <span class="st">"/opt/nonmem/nm751/run/nmfe75"</span>,</span>
<span>              <span class="st">"C:/nm75g64/run/nmfe75.bat"</span><span class="op">)</span></span>
<span><span class="va">path.nonmem</span> <span class="op">&lt;-</span> <span class="va">paths.nm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">paths.nm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/NMdataConf.html" class="external-link">NMdataConf</a></span><span class="op">(</span>path.nonmem<span class="op">=</span><span class="va">path.nonmem</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specify-the-psn-installation-path">Specify the PSN installation path<a class="anchor" aria-label="anchor" href="#specify-the-psn-installation-path"></a>
</h3>
<p>If PSN is available, and you can run <code>execute</code> and
<code>update_inits</code> in a terminal, you don’t need to configure how
NMsim finds PSN. If you have PSN installed, but you have to provide the
paths to those two executables when running them (something like
<code>/opt/PSN/execute run1.mod</code>), you will have to tell NMsim
where to find them. In this case, the easiest is loading NMdata and then
running:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/NMdataConf.html" class="external-link">NMdataConf</a></span><span class="op">(</span>dir.psn<span class="op">=</span><span class="st">"/opt/PSN"</span><span class="op">)</span></span></code></pre></div>
<p>Notice <code>dir.psn</code> refers to a directory while
<code>path.nonmem</code> refers to a file.</p>
</div>
<div class="section level3">
<h3 id="test-nmsim-configuration">Test NMsim Configuration<a class="anchor" aria-label="anchor" href="#test-nmsim-configuration"></a>
</h3>
<p>Whether NMsim finds Nonmem after the configuration steps above can be
checked by running <code><a href="../reference/NMsimTestConf.html">NMsimTestConf()</a></code>. Look for
<code>$path.nonmem</code> (where NMsim is looking for the executable),
<code>$exists.path.nonmem</code> (whethere the executable is found), and
<code>$method.execute</code> (which method is selected - “nmsim” is
prefered).</p>
</div>
<div class="section level3">
<h3 id="configure-the-directories-nmsim-writes-to">Configure the directories <code>NMsim</code> writes to<a class="anchor" aria-label="anchor" href="#configure-the-directories-nmsim-writes-to"></a>
</h3>
<p><code>NMsim</code> creates two main directories for its output.</p>
<div class="section level4">
<h4 id="dir-sims">
<code>dir.sims</code><a class="anchor" aria-label="anchor" href="#dir-sims"></a>
</h4>
<ul>
<li><p>simulation control streams and other data created by
NMsim</p></li>
<li><p>output written by Nonmem</p></li>
<li><p>By far, the largest directory</p></li>
</ul>
<p>These files are not necessarily needed for further storage.</p>
</div>
<div class="section level4">
<h4 id="dir-res">
<code>dir.res</code><a class="anchor" aria-label="anchor" href="#dir-res"></a>
</h4>
<p>Selected and efficiently stored simulation output data.</p>
<ul>
<li><p><code>_paths.rds</code> which contains an index table for
`NMreadSim()1. It does not contain any simulated data and is of
insignificant size.</p></li>
<li><p><code>.fst</code> is the full simulation output data set.
<code><a href="../reference/NMreadSim.html">NMreadSim()</a></code> will automatically create this file the first
time it reads <code>_paths.rds</code>. The user does not need to know
about the <code>fst</code> format as they will keep reading the
simulation results via <code><a href="../reference/NMreadSim.html">NMreadSim()</a></code> on
<code>_paths.rds</code>.</p></li>
</ul>
<p>You must make sure to preserve this directory in case you will need
to re-analyze or further analyze the simulation output without
re-running the simulations.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="psn-or-not">PSN or not?<a class="anchor" aria-label="anchor" href="#psn-or-not"></a>
</h2>
<div class="section level3">
<h3 id="psn-or-not-for-nonmem-execution">PSN or not for Nonmem execution<a class="anchor" aria-label="anchor" href="#psn-or-not-for-nonmem-execution"></a>
</h3>
<p>NMsim can call Nonmem using PSN’s <code>execute</code> or through
similar functionality included in NMsim. We will refer to those methods
by the way they are referred to in the <code><a href="../reference/NMsim.html">NMsim()</a></code> function
argument that controls which one is used,
i.e. <code>method.execute="psn"</code> and
<code>method.execute="nmsim"</code>. While <code>PSN</code> users will
be familiar with what <code>PSN</code>’s <code>execute</code> does,
<code>method.execute="nmsim"</code> needs a few words of explanation. It
is essentially an R-based method similar to <code>PSN</code>’s
<code>execute</code>, meaning it creates a temporary folder containing
necessary files for running Nonmem, then runs <code>nmfe</code> (as
specified using <code>path.nonmem</code>) and then copies the desired
result files back to the location of the input control stream.
<code>NMsim</code> can control the behavior of this function better than
it can <code>PSN</code>’s execute which enables NMsim to do additional
things with <code>method.execute="nmsim"</code>.</p>
<p>For simulations, <code>method.execute="psn"</code> does not provide
advantages over <code>method.execute="nmsim"</code>. In contrast, there
are simulation types that will only work with
<code>method.execute="nmsim"</code>. You need to tell NMsim where to
find Nonmem (by setting <code>path.nonmem</code>) for this to work.</p>
</div>
<div class="section level3">
<h3 id="psn-or-not-for-updating-initial-values">PSN or not for updating initial values<a class="anchor" aria-label="anchor" href="#psn-or-not-for-updating-initial-values"></a>
</h3>
<p>NMsim needs to update initial values using the model estimate prior
to running a simulation.</p>
<p>PSN provides the <code>update_inits</code> function to do this. We
refer to this by how it is enabled in NMsim,
<code>inits=list(method="psn")</code>.</p>
<p>NMsim also provides a similar functionality internally, referred to
as <code>inits=list(method="NMsim")</code>. This is the default method
and comes with advanced features such as conservation of structure and
comments of parameter sections, and a fully featured interface to
specify values and features such as “fix” or limits of parameters.</p>
<p><code>inits=list(method="psn")</code> may be prefered by users who
are familiar with PSN. <code>inits=list(method="psn")</code> has
additional features, and no known down-sides.</p>
<p>In order to make use of <code>inits=list(method="psn")</code>, you
need to make sure NMsim can find PSN. If you want to use
<code>inits=list(method="NMsim")</code> you don’t need to do
anything.</p>
</div>
<div class="section level3">
<h3 id="input-model-file-name-extensions">Input model file name extensions<a class="anchor" aria-label="anchor" href="#input-model-file-name-extensions"></a>
</h3>
<p>The following requirements to file name and their contents concerns
the “input model”. It does not concern files generated by
<code>NMsim</code>.</p>
<p>There is no requirement to the file name extension of the input
control stream. <code>NMsim</code> function documentation and their
argument <code>file.mod</code> refer to input control streams by
<code>.mod</code>. However, the input control stream can have any
extension (e.g., <code>.ctl</code> or <code>.txt</code>).</p>
<p>The estimate files (<code>.ext</code>, <code>.phi</code> if known
subjects simulated, <code>.cov</code> if simulating parameters from the
covariance step) are by default expected to carry the same file name but
with those file name extension. See arguments like <code>file.ext</code>
and <code>file.phi</code> to specify other paths. Currently, the default
behavior cannot be customized and the two arguments will have to be
provided at each NMsim() call to the extend relevant for the
simulation.</p>
<p>Output table files from input model may be needed. This is the case
using <code>NMsim_known</code> on models estimated using Bayesian
<code>$ESTIMATION</code> methods like <code>SAEM</code> and/or
<code>$IMP</code>. In this case <code>NMsim</code> will need to find all
the <code>ETA</code> values for all subjects, even if spread across the
output tables. This is because these estimation methods leave
<code>PHI</code> instead of <code>ETA</code> in the <code>.phi</code>
file. For emperical Bayes estimates, <code>NMsim</code> needs the
<code>ETA</code>s.</p>
<p>There are no limitations to the file names of the output tables.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Philip Delff.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>



  <script data-goatcounter="https://nmsim.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
