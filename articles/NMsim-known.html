<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulate Known Subjects Using Emperical Bayes Estimates (Etas/Phis) • NMsim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Simulate Known Subjects Using Emperical Bayes Estimates (Etas/Phis)">
<meta name="google-site-verification" content="-8n-8OfzJii_lVruWfxXOhzUATKSgMdiSxMhOQoscu4">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NMsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/NMsim-intro.html">NMsim Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-VPC.html">Simulations for VPCs</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-config.html">Requirements and Configuration</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-known.html">Simulate Known Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ParamUncertain.html">Simulations with Parameter Uncertainty</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-forest.html">Simulation-based forest plots with NMsim</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-DataCreate.html">Data Set Creation with NMsim</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ResidVar.html">Simulation with Residual Variability</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-varyPars.html">Simulate Models with Modifications</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ReuseSimSubjects.html">Reuse Simulated Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-speed.html">Debugging, Speed, and Disk Space</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/NMsim-publications.html">Publications</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NMautoverse/NMsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NMautoverse/NMsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulate Known Subjects Using Emperical Bayes Estimates (Etas/Phis)</h1>
                        <h4 data-toc-skip class="author">Philip
Delff</h4>
                        
            <h4 data-toc-skip class="date">May 21, 2025 using NMsim
0.2.3</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/NMautoverse/NMsim/blob/main/vignettes/NMsim-known.Rmd" class="external-link"><code>vignettes/NMsim-known.Rmd</code></a></small>
      <div class="d-none name"><code>NMsim-known.Rmd</code></div>
    </div>

    
    
<p><img src="../reference/figures/NMsimlogo240.png" align="right" height="120" alt="NMsim"></p>
<div class="section level2">
<h2 id="objectives">Objectives<a class="anchor" aria-label="anchor" href="#objectives"></a>
</h2>
<p>This vignettes aims at enabling you to use <code>NMsim</code> for the
following purposes</p>
<ul>
<li>Simualation of known subjects (estimated random effects),</li>
</ul>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>Simulation with known ETA values is only possible through NMsim’s
internal Nonmem execution method. That means, we need to provide the
path to the Nonmem executable.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/NMdataConf.html" class="external-link">NMdataConf</a></span><span class="op">(</span>path.nonmem<span class="op">=</span><span class="st">"/opt/NONMEM/nm75/run/nmfe75"</span><span class="op">)</span></span></code></pre></div>
<p>More information on configuration and test of configuration at <a href="https://nmautoverse.github.io/NMsim/articles/NMsim-config.html" class="external-link"><code>NMsim-config.html</code></a>.</p>
<p>You should be familiar with basic <code>NMsim</code> arguments as
described in <a href="https://nmautoverse.github.io/NMsim/articles/NMsim-intro.html" class="external-link"><code>NMsim-intro.html</code></a>.
That vignette mostly talks about the default simulation method (new
subjects). This vignette provides various examples on how the
<code>NMsim_EBE</code> simulation method can be used to simulate “known”
subjects. We shall explain in more detail what is meant by a “known
subject”. Briefly it means their ETAs are known. The most common example
of this is resimulation of subjects that were in the estimation data
set.</p>
</div>
<div class="section level2">
<h2 id="simulation-of-known-subjects">Simulation of known subjects<a class="anchor" aria-label="anchor" href="#simulation-of-known-subjects"></a>
</h2>
<p>We sometimes want to simulate the observed subjects, i.e. the
subjects we included in the estimation data. We want to reuse the
estimated random effects (ETA’s) given the subject ID’s.
<code>NMsim</code> has a method for this called <code>NMsim_EBE</code>.
The restriction is that all subjects (values of <code>ID</code>) in the
simulation input data must have been used in the estimation input
data.</p>
<p>For <code>NMsim_EBE</code> to work, <code>ID</code> values in the
simulation data set must be identical to <code>ID</code> values used in
the estimation. For models estimated with FOCEI, the ETAs are stored in
the <code>.phi</code> file produced by Nonmem. This file must be
available, and NMsim will automatically use it if applicable.</p>
<p>For EM-based estimation methods such as SAEM or IMP, NMsim cannot use
the <code>.phi</code> file, and the user must have stored the ETAs in
output table files for the method to work. It does not matter where in
the table files they are, they just all need to be there. You can write
all of them like it is done in the example model provided with
<code>NMsim</code> called <code>xgxr032.mod</code>.</p>
<p>If using EM algorithms such as SAEM or IMP, remember to explicitly
write ETAs to an output table in the Nonmem control stream:</p>
<pre><code>$TABLE ETAS(1:LAST) NOAPPEND NOPRINT FILE=xgxr032_etas.txt</code></pre>
<p>So a “subject” essentially means a set of ETAs. Covariates must still
be provided in the input data set and can be modified if wanted. Notice,
<code>NMsim_EBE</code> does nothing to restore covariates - you must
define covariates in input data as needed.</p>
</div>
<div class="section level2">
<h2 id="simulate-known-subjects-on-a-new-dosing-regimen-and-new-sample-schedule">Simulate known subjects on a new dosing regimen and new sample
schedule<a class="anchor" aria-label="anchor" href="#simulate-known-subjects-on-a-new-dosing-regimen-and-new-sample-schedule"></a>
</h2>
<p>The following code takes an already created simulation data set with
a single ID, and merges all other columns than <code>ID</code> onto the
observed <code>ID</code>s. That gives the same simulation data for all
subjects.</p>
<p>First thing, we decide on a model (an input control stream of an
estimated model) to use for the example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/nonmem/xgxr134.mod"</span>,package<span class="op">=</span><span class="st">"NMsim"</span><span class="op">)</span></span></code></pre></div>
<p>We generate a simulation data set with a loading dose (300 mg)
followed by 6 doses (150 mg) every 24 hours. For smoothness plotted
curves we use hourly sampling.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NMcreateDoses.html">NMcreateDoses</a></span><span class="op">(</span>TIME<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">24</span><span class="op">)</span>,AMT<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>,<span class="fl">150</span><span class="op">)</span>,ADDL<span class="op">=</span><span class="fl">5</span>,II<span class="op">=</span><span class="fl">24</span>,CMT<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">## Now we add the sample records using `NMaddSamples()`. </span></span>
<span><span class="va">dat.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NMaddSamples.html">NMaddSamples</a></span><span class="op">(</span><span class="va">doses</span>,TIME<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fl">24</span><span class="op">*</span><span class="fl">7</span><span class="op">)</span>,CMT<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## read model results just to extract the observed ID's. Notice, if</span></span>
<span><span class="co">## your model uses covariates, those should be retrieved too.</span></span>
<span><span class="va">res.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/NMscanData.html" class="external-link">NMscanData</a></span><span class="op">(</span><span class="va">file.mod</span>,quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">res.mod</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>,<span class="st">"WEIGHTB"</span>,<span class="st">"AGE"</span>,<span class="st">"MALEN"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Repeat the simulation data set for each ID and order accordingly</span></span>
<span></span>
<span><span class="co">## we will merge with all the observed subjects in stead of the single</span></span>
<span><span class="co">## ID in the original data set.</span></span>
<span><span class="va">dat.sim</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">dat.sim.known</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/egdt.html" class="external-link">egdt</a></span><span class="op">(</span><span class="va">ids</span>,</span>
<span>                      <span class="va">dat.sim</span></span>
<span>                      <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">setorder</a></span><span class="op">(</span><span class="va">dat.sim.known</span>,<span class="va">ID</span>,<span class="va">TIME</span>,<span class="va">EVID</span><span class="op">)</span></span>
<span><span class="co">## check data</span></span>
<span><span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/NMcheckData.html" class="external-link">NMcheckData</a></span><span class="op">(</span><span class="va">dat.sim.known</span>,type.data<span class="op">=</span><span class="st">"sim"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simres.known</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NMsim.html">NMsim</a></span><span class="op">(</span>file.mod<span class="op">=</span><span class="va">file.mod</span>,</span>
<span>                      data<span class="op">=</span><span class="va">dat.sim.known</span>,</span>
<span>                      method.sim<span class="op">=</span><span class="va">NMsim_EBE</span>,</span>
<span>                      table.vars<span class="op">=</span><span class="st">"PRED IPRED CL V2 KA"</span>,</span>
<span>                      name.sim<span class="op">=</span><span class="st">"known1"</span></span>
<span>                      <span class="op">)</span></span></code></pre></div>
<p>And the simulation results are plotted for each subject.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">simres.known</span>,<span class="va">EVID</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">TIME</span>,<span class="va">IPRED</span>,colour<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="NMsim-known_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<!-- Show a plot of the individual parameters in estimate and in sim -->
</div>
<div class="section level2">
<h2 id="individual-dosing-history-sample-times-or-both">Individual dosing history, sample times or both<a class="anchor" aria-label="anchor" href="#individual-dosing-history-sample-times-or-both"></a>
</h2>
<p>Individual simulations are useful for several purposes. Examples</p>
<ul>
<li><p>Reuse individual dosing history and use a new common sample
scheme. This could be for homogeneous evaluation of exposure metrics
such as Cmax, AUC, or just to show concentration-time profiles at
identical sampling times based on a model estimated on data with
heterogeneos sampling. Currently, there is no example of this in this
vignette but see the other examples, and it should be pretty clear how
to do this.</p></li>
<li><p>Reuse dosing history and use individual sampling scheme from a
different data set, e.g. PD.</p></li>
<li><p>Simulate a new common dosing and sampling scheme to simulate
already observed subjects on a new regimen. This is sometimes done if
for one reason or the other the model is not considered reliable for
simulation of new subjects but the individual parameter estimates are
trusted.</p></li>
<li><p>Reuse a simulated population. One may prefer to reuse the same
simulated subjects in multiple simulations for reproducibility and to
have all difference between say simulation results of different regimens
be driven by differences in the regimen, and not in the populations.
This use of <code>NMsim_EBE</code> is on the todo list tog get it’s own
vignette <a href="https://nmautoverse.github.io/NMsim/articles/NMsim-ReuseSimSubjects.html" class="external-link">here</a>.</p></li>
</ul>
<div class="section level3">
<h3 id="simulate-individual-dosing-history-at-new-individual-sampling-times-for-a-pkpd-dataset">Simulate individual dosing history at new individual sampling times
for a PK/PD dataset<a class="anchor" aria-label="anchor" href="#simulate-individual-dosing-history-at-new-individual-sampling-times-for-a-pkpd-dataset"></a>
</h3>
<p>We want to plot some PD data angainst PK. However, PD was sampled
differnetly than PK, and we want to evaluate the individual predictions
of the PK model at the individual PD samplng times - reusing the
individual dosing history.</p>
<p>Reading some example PD data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/data/xgxr_pd.rds"</span>,package<span class="op">=</span><span class="st">"NMsim"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## some code below makes use of data.table features so we make it a data.table</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">pd</span><span class="op">)</span></span></code></pre></div>
<p>For a PK model without time-varying covariates, suggested steps to
generate the data for the simulation are:</p>
<ul>
<li>Take dose records from PK model estimation input data
(<code>pkdos</code>). Just keep necessary columns like <code>ID</code>,
<code>TIME</code>, <code>EVID</code>, <code>CMT</code>,
<code>AMT</code>, <code>ADDL</code>, <code>II</code>, and any necessary
covariates</li>
<li>Take PD data observation records (<code>pdsamples</code>). Just keep
<code>ID</code>, <code>TIME</code>, and set <code>EVID=2</code>.</li>
<li>Add a unique row identifier to <code>pdsamples</code> (an integer
row counter, like <code>ROW=1:nrow(pdsamples)</code>)</li>
<li>Stack (<code>rbind</code> for data.tables or <code>bind_rows</code>
in tidyverse) <code>pkdos</code> and <code>pdsamples</code> to one data
set (<code>pdsim</code>)</li>
<li>In <code>pdsim</code>, set <code>DV=NA</code>
</li>
<li>Sort <code>pdsim</code> at least by <code>ID</code>,
<code>TIME</code> and <code>EVID</code>. There could be more depending
on trial design</li>
</ul>
<p>In case of time-varying covariates, you can keep all data records
from the PK data (without <code>DV</code>), but change observation
records to simulation records (<code>EVID=2</code> instead of
<code>EVID=0</code>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Take dose records from PK model estimation input data</span></span>
<span><span class="va">pkres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nmautoverse.github.io/NMdata/reference/NMscanData.html" class="external-link">NMscanData</a></span><span class="op">(</span><span class="va">file.mod</span>,quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pkdos</span> <span class="op">&lt;-</span> <span class="va">pkres</span><span class="op">[</span><span class="va">EVID</span><span class="op">==</span><span class="fl">1</span>,<span class="fu">.</span><span class="op">(</span><span class="va">ID</span>, <span class="va">TIME</span>, <span class="va">EVID</span>, <span class="va">CMT</span>, <span class="va">AMT</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">## Take PD data observation records (`pdsamples`)</span></span>
<span><span class="va">pdsamples</span> <span class="op">&lt;-</span> <span class="va">pd</span><span class="op">[</span><span class="va">EVID</span><span class="op">==</span><span class="fl">0</span>,<span class="fu">.</span><span class="op">(</span><span class="va">ID</span>,<span class="va">TIME</span>,<span class="va">LIDV</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">## Stack `pkdos` and `pdsamples` to one data set (`pdsim`)</span></span>
<span><span class="va">pdsim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">pkdos</span>,<span class="va">pdsamples</span>,fill<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## Nonmem needs a DV column to run</span></span>
<span><span class="va">pdsim</span><span class="op">[</span>,<span class="va">DV</span><span class="op">:=</span><span class="cn">NA</span><span class="op">]</span></span>
<span><span class="co">## only include subjects that were included in the PK model</span></span>
<span><span class="va">pdsim</span> <span class="op">&lt;-</span> <span class="va">pdsim</span><span class="op">[</span><span class="va">ID</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">pkres</span><span class="op">$</span><span class="va">ID</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">setorder</a></span><span class="op">(</span><span class="va">pdsim</span>,<span class="va">ID</span>,<span class="va">TIME</span>,<span class="va">EVID</span><span class="op">)</span></span></code></pre></div>
<p>Then run <code>NMsim</code> like this. We are renaming the prediction
columns using Nonmem <code>$TABLE</code> statement not to confuse PK
predictions and PD predictions.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simres.pksim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NMsim.html">NMsim</a></span><span class="op">(</span><span class="va">file.mod</span>,</span>
<span>                      data<span class="op">=</span><span class="va">pdsim</span>,</span>
<span>                      name.sim<span class="op">=</span><span class="st">"pkpd"</span>,</span>
<span>                      method.sim<span class="op">=</span><span class="va">NMsim_EBE</span>,</span>
<span>                      table.vars<span class="op">=</span><span class="st">"PKIPRED=IPRED PKPRED=PRED"</span></span>
<span>                      <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">simres.pksim</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">LIDV</span><span class="op">)</span><span class="op">&amp;</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">PKIPRED</span><span class="op">)</span><span class="op">]</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">PKIPRED</span>,<span class="va">LIDV</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Individual PK prediction"</span>,y<span class="op">=</span><span class="st">"Observed PD value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="NMsim-known_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Philip Delff.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>



  <script data-goatcounter="https://nmsim.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>
