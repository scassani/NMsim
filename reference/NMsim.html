<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Simulate from an estimated Nonmem model — NMsim • NMsim</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><script src="../extra.js"></script><meta property="og:title" content="Simulate from an estimated Nonmem model — NMsim"><meta name="description" content="Supply a data set and an estimation input control stream, and
NMsim can create neccesary files (control stream, data files), run
the simulation and read the results. It has additional methods for
other simulation types available, can do multiple simulations at
once and more. Please see vignettes for an introduction to how to
get the most out of this."><meta property="og:description" content="Supply a data set and an estimation input control stream, and
NMsim can create neccesary files (control stream, data files), run
the simulation and read the results. It has additional methods for
other simulation types available, can do multiple simulations at
once and more. Please see vignettes for an introduction to how to
get the most out of this."><meta name="google-site-verification" content="-8n-8OfzJii_lVruWfxXOhzUATKSgMdiSxMhOQoscu4"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NMsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/NMsim-intro.html">NMsim Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-VPC.html">Simulations for VPCs</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-config.html">Requirements and Configuration</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-known.html">Simulate Known Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ParamUncertain.html">Simulations with Parameter Uncertainty</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-forest.html">Simulation-based forest plots with NMsim</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-DataCreate.html">Data Set Creation with NMsim</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ResidVar.html">Simulation with Residual Variability</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-varyPars.html">Simulate Models with Modifications</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-ReuseSimSubjects.html">Reuse Simulated Subjects</a></li>
    <li><a class="dropdown-item" href="../articles/NMsim-speed.html">Debugging, Speed, and Disk Space</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/NMsim-publications.html">Publications</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NMautoverse/NMsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NMautoverse/NMsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulate from an estimated Nonmem model</h1>
      <small class="dont-index">Source: <a href="https://github.com/NMautoverse/NMsim/blob/main/R/NMsim.R" class="external-link"><code>R/NMsim.R</code></a></small>
      <div class="d-none name"><code>NMsim.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Supply a data set and an estimation input control stream, and
NMsim can create neccesary files (control stream, data files), run
the simulation and read the results. It has additional methods for
other simulation types available, can do multiple simulations at
once and more. Please see vignettes for an introduction to how to
get the most out of this.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">NMsim</span><span class="op">(</span></span>
<span>  <span class="va">file.mod</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  subproblems <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  reuse.results <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">seed.R</span>,</span>
<span>  <span class="va">seed.nm</span>,</span>
<span>  <span class="va">name.sim</span>,</span>
<span>  <span class="va">table.vars</span>,</span>
<span>  <span class="va">table.options</span>,</span>
<span>  table.format <span class="op">=</span> <span class="st">"s1PE16.9"</span>,</span>
<span>  carry.out <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method.sim <span class="op">=</span> <span class="va">NMsim_default</span>,</span>
<span>  typical <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">inits</span>,</span>
<span>  <span class="va">modify</span>,</span>
<span>  <span class="va">filters</span>,</span>
<span>  <span class="va">sizes</span>,</span>
<span>  path.nonmem <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sge <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nc <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  execute <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  script <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transform <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  order.columns <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">method.execute</span>,</span>
<span>  <span class="va">nmrep</span>,</span>
<span>  col.flagn <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sim.dir.from.scratch <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  create.dirs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">dir.psn</span>,</span>
<span>  <span class="va">args.psn.execute</span>,</span>
<span>  <span class="va">args.NMscanData</span>,</span>
<span>  <span class="va">as.fun</span>,</span>
<span>  system.type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">dir.sims</span>,</span>
<span>  <span class="va">dir.res</span>,</span>
<span>  <span class="va">file.res</span>,</span>
<span>  <span class="va">wait</span>,</span>
<span>  text.sim <span class="op">=</span> <span class="st">""</span>,</span>
<span>  auto.dv <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">clean</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">nmquiet</span>,</span>
<span>  <span class="va">progress</span>,</span>
<span>  check.mod <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  format.data.complete <span class="op">=</span> <span class="st">"rds"</span>,</span>
<span>  <span class="va">text.table</span>,</span>
<span>  <span class="va">suffix.sim</span>,</span>
<span>  <span class="va">seed</span>,</span>
<span>  file.ext <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">method.update.inits</span>,</span>
<span>  <span class="va">modify.model</span>,</span>
<span>  <span class="va">list.sections</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-file-mod">file.mod<a class="anchor" aria-label="anchor" href="#arg-file-mod"></a></dt>
<dd><p>Path(s) to the input control stream(s) to run the
simulation on. The output control stream is for now assumed to
be stored next to the input control stream and ending in .lst
instead of .mod. The .ext file must also be present. If
simulating known subjects, the .phi is necessary too.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>The simulation data as a <code>data.frame</code> or a list
of <code>data.frame</code>s. If a list, the model(s) will be run on
each of the data sets in the list.</p></dd>


<dt id="arg-subproblems">subproblems<a class="anchor" aria-label="anchor" href="#arg-subproblems"></a></dt>
<dd><p>Number of subproblems to use as
<code>SUBPROBLEMS</code> in <code>$SIMULATION</code> block in Nonmem. The
default is subproblem=0 which means not to use
<code>SUBPROBLEMS</code>.</p></dd>


<dt id="arg-reuse-results">reuse.results<a class="anchor" aria-label="anchor" href="#arg-reuse-results"></a></dt>
<dd><p>If simulation results found on file, should
they be used? If TRUE and reading the results fail, the
simulations will still be rerun.</p></dd>


<dt id="arg-seed-r">seed.R<a class="anchor" aria-label="anchor" href="#arg-seed-r"></a></dt>
<dd><p>A value passed to <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code>. It is
recommended to use <code>seed.R</code> rather than calling
<code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> manually because the seed can then be
captured and stored by <code>NMsim()</code> for reproducibility. See
<code>seed.nm</code> for finer control of the seeds that are used in
the Nonmem control streams.</p></dd>


<dt id="arg-seed-nm">seed.nm<a class="anchor" aria-label="anchor" href="#arg-seed-nm"></a></dt>
<dd><p>Control Nonmem seeds. If a numeric, a vector or a
    `data.frame`, these are used as the the seed values (a single
    value or vector will be recycled so make sure the dimesnsions
    are right, the number of columns in a <code>data.frame</code> will
    dictate the number of seeds in each Nonmem control stream. Use
    a list with elements `values`, and `dist` and others for
    detailed control of the random sources. See <code><a href="NMseed.html">?NMseed</a></code> for
    details on what arguments can be passed this way.</p>
<p>Default is to draw seeds betwen
    0 and 2147483647 (the values supported by Nonmem) for each
    simulation. You can pass a function that will be evaluated
    (say to choose a different pool of seeds to draw from).</p>
<p>To avoid changing an exisiting seed in a control stream, use
<code>seed.nm="asis"</code>.</p>
<p>In case <code>method.sim=NMsim_EBE</code>, seeds are not used.</p></dd>


<dt id="arg-name-sim">name.sim<a class="anchor" aria-label="anchor" href="#arg-name-sim"></a></dt>
<dd><p>Give all filenames related to the simulation a
suffix. A short string describing the sim is recommended like
"ph3_regimens".</p></dd>


<dt id="arg-table-vars">table.vars<a class="anchor" aria-label="anchor" href="#arg-table-vars"></a></dt>
<dd><p>Variables to be printed in output table as a
character vector or a space-separated string of variable
names. The default is to export the same tables as listed in
the input control stream. If <code>table.vars</code> is provided,
all output tables in estimation control streams are dropped
and replaced by a new one with just the provided variables. If
many variables are exported, and much fewer are used, it can
speed up NMsim significantly to only export what is needed
(sometimes this is as little as "PRED IPRED"). Nonmem writes
data slowly so reducing output data can make a very big
difference in execution time. See <code>table.options</code> too.</p></dd>


<dt id="arg-table-options">table.options<a class="anchor" aria-label="anchor" href="#arg-table-options"></a></dt>
<dd><p>A character vector or a string of
space-separated options. Only used if <code>table.vars</code> is
provided. If constructing a new output table with
<code>table.vars</code> the default is to add two options,
<code>NOAPPEND</code> and <code>NOPRINT</code>. You can modify that with
<code>table.options</code>. Do not try to modify output filename -
<code>NMsim</code> takes care of that. See `table.format` too.</p></dd>


<dt id="arg-table-format">table.format<a class="anchor" aria-label="anchor" href="#arg-table-format"></a></dt>
<dd><p>A format for `$TABLE`. Only used if
`table.vars` is provided. Default is "s1PE16.9". NMsim needs a
high-resolution format. The Nonmem default "s1PE11.4" is
insufficient for simulation data sets of 1e5 rows or more.</p></dd>


<dt id="arg-carry-out">carry.out<a class="anchor" aria-label="anchor" href="#arg-carry-out"></a></dt>
<dd><p>Variables from input data that should be included
in results. Default is to include everything. If working with
large data sets, it may be wanted to provide a subset of the
columns here. If doing very large simulations, this may also
be a way to save memory.</p></dd>


<dt id="arg-method-sim">method.sim<a class="anchor" aria-label="anchor" href="#arg-method-sim"></a></dt>
<dd><p>A function (not quoted) that creates the
simulation control stream and other necessary files for a
simulation based on the estimation control stream, the data,
etc. The default is called <code>NMsim_default</code> which will
replace any estimation and covariance step by a simulation
step. See details section on oter methods, and see examples
and especially vignettes on how to use the different provided
methods.</p></dd>


<dt id="arg-typical">typical<a class="anchor" aria-label="anchor" href="#arg-typical"></a></dt>
<dd><p>Run with all ETAs fixed to zero? Technically all
ETAs=0 is obtained by replacing <code>$OMEGA</code> by a zero
matrix. Default is `FALSE`.</p></dd>


<dt id="arg-inits">inits<a class="anchor" aria-label="anchor" href="#arg-inits"></a></dt>
<dd><p>Control the parameter values. `inits` is a list. The
    `method` element controls which method is used to do this, and
    this corresponds to the old `method.update.inits` argument. If
    using the new `method=nmsim` you can specify parameter
    values, fix/unfix them, and edit lower and upper limits for
    estimation.</p><ul><li><p>`method="nmsim"`, all other
    arguments are passed to `NMwriteInits`. This is a flexible
    method that allows for modification of the parameter values
    and is expected to be the default method in the
    future. Example which will update the parameter values based
    on the available estimate, but with `THETA(2)=1.3`:
    `inits=list(method="nmsim","THETA(2)"=list(init=1.3))`. See
    `?NMwriteInits` too.</p></li>
<li><p>`method="psn"`
    uses PSN's "update_inits". Requires a functioning PSN
    installation and possibly that <code>dir.psn</code> is correctly
    set. The advantages of this method are that it keeps comments
    in the control stream and that it is a method known to many.</p></li>
<li><p>`method="nmsim"`
 Uses a simple internal method to update the parameter values
based on the ext file.  The advantages of "nmsim" are it does not
require PSN, and that it does not rely on code-interpretation for generation of simulation control streams. "nmsim" fixes the whole
OMEGA and SIGMA matrices as single blocks making the $OMEGA and
$SIGMA sections of the control streams less easy to read. On the
other hand, this method is robust because it avoids any
interpretation of BLOCK structure or other code in the control
streams.</p></li>
<li><p>`method="none"` Do nothing. This is useful if the model to simulate
has not been estimated but parameter values have been manually put
into the respective sections in the control stream.</p></li>
</ul><p>See also `file.ext` which can now be handled by `inits` too. This
change collects the update of the "initial"
parameter values into one interface rather than multiple
arguments.</p></dd>


<dt id="arg-modify">modify<a class="anchor" aria-label="anchor" href="#arg-modify"></a></dt>
<dd><p>Named list of additional control stream
section edits. Note, these can be functions that define how to
edit sections. This is an advanced feature which is not needed
to run most simulations. It is however powerful for some types
of analyses, like modifying parameter values. See vignettes
for further information.</p></dd>


<dt id="arg-filters">filters<a class="anchor" aria-label="anchor" href="#arg-filters"></a></dt>
<dd><p>Edit data filters (`IGNORE`/`ACCEPT` statements)
before running model. This should normally only be used if no
data set is provided. It can be useful if simulating for a VPC
but a different subset of data needs to be simulated than the
one used for estimation. A common example on this is inclusion
of BLQ's in the VPC even if they were excluded in the
estimation. See `?NMreadFilters` which returns a table you can
edit and pass to `filters`. You can also just pass a string
representing the full set of filters to be used. If you pass a
string, consider including "IGN=@" to avoid character rows,
like the column headers.</p></dd>


<dt id="arg-sizes">sizes<a class="anchor" aria-label="anchor" href="#arg-sizes"></a></dt>
<dd><p>If needed, adjust the `$SIZES` section by providing a
list of arguments to `NMupdateSizes()`. Example:
`sizes=list(PD=80)`. See `?NMupdateSizes` for details. Don't
use arguments like `file.mod` and `newfile` which are handled
internally.</p></dd>


<dt id="arg-path-nonmem">path.nonmem<a class="anchor" aria-label="anchor" href="#arg-path-nonmem"></a></dt>
<dd><p>The path to the Nonmem executable to use. The
could be something like "/usr/local/NONMEM/run/nmfe75" (which
is a made up example). No default is available. You should be
able to figure this out through how you normally execute
Nonmem, or ask a colleague.</p></dd>


<dt id="arg-sge">sge<a class="anchor" aria-label="anchor" href="#arg-sge"></a></dt>
<dd><p>Submit to cluster? Default is not to, but this is very
useful if creating a large number of simulations,
e.g. simulate with all parameter estimates from a bootstrap
result.</p></dd>


<dt id="arg-nc">nc<a class="anchor" aria-label="anchor" href="#arg-nc"></a></dt>
<dd><p>Number of cores used in parallelization. Only used if
`sge=TRUE`.</p></dd>


<dt id="arg-execute">execute<a class="anchor" aria-label="anchor" href="#arg-execute"></a></dt>
<dd><p>Execute the simulation or only prepare it?
`execute=FALSE` can be useful if you want to do additional
tweaks or simulate using other parameter estimates.</p></dd>


<dt id="arg-script">script<a class="anchor" aria-label="anchor" href="#arg-script"></a></dt>
<dd><p>The path to the script where this is run. For
stamping of dataset so results can be traced back to code.</p></dd>


<dt id="arg-transform">transform<a class="anchor" aria-label="anchor" href="#arg-transform"></a></dt>
<dd><p>A list defining transformations to be applied
after the Nonmem simulations and before plotting. For each
list element, its name refers to the name of the column to
transform, the contents must be the function to apply.</p></dd>


<dt id="arg-order-columns">order.columns<a class="anchor" aria-label="anchor" href="#arg-order-columns"></a></dt>
<dd><p>reorder columns by calling
<code><a href="https://nmautoverse.github.io/NMdata/reference/NMorderColumns.html" class="external-link">NMdata::NMorderColumns</a></code> before saving dataset and
running simulations? Default is TRUE.</p></dd>


<dt id="arg-method-execute">method.execute<a class="anchor" aria-label="anchor" href="#arg-method-execute"></a></dt>
<dd><p>Specify how to call Nonmem. Options are
"psn" (PSN's execute), "nmsim" (an internal method similar to
PSN's execute), and "direct" (just run Nonmem directly and
dump all the temporary files). "nmsim" has advantages over
"psn" that makes it the only supported method when
type.sim="NMsim_EBE". "psn" has the simple advantage that the
path to nonmem does not have to be specified if "execute" is
in the system search path. So as long as you know where your
Nonmem executable is, "nmsim" is recommended. The default is
"nmsim" if path.nonmem is specified, and "psn" if not.</p></dd>


<dt id="arg-nmrep">nmrep<a class="anchor" aria-label="anchor" href="#arg-nmrep"></a></dt>
<dd><p>Include `NMREP` as counter of subproblems? The
default is to do so if `subproblems&gt;0`. This will insert a
counter called `NMREP` in the `$ERROR` section and include
that in the output table(s). At this point, nothing is done to
avoid overwriting existing variables.</p></dd>


<dt id="arg-col-flagn">col.flagn<a class="anchor" aria-label="anchor" href="#arg-col-flagn"></a></dt>
<dd><p>Only used if `data` is provided. Use this if you
are including an exclusion flag column in data. However, what
NMsim will then do is to require that column to equal `0`
(zero) for the rows to be simulated. It is often better to
subset the data before simulation. See `filters` too.</p></dd>


<dt id="arg-sim-dir-from-scratch">sim.dir.from.scratch<a class="anchor" aria-label="anchor" href="#arg-sim-dir-from-scratch"></a></dt>
<dd><p>If TRUE (default) this will wipe the
simulation directory before running new simulations. The
directory that will be emptied is _not_ dir.sims where you may
keep many or all your simulations. It is the subdirectory
named based on the run name and <code>name.sim</code>. The reason it
is advised to wipe this directory is that if you in a previous
simulation created simulation runs that are now obsolete, you
could end up reading those too when collecting the
results. NMsim will delete previously generated simulation
control streams with the same name, but this option goes
further. An example where it is important is if you first ran
1000 replications, fixed something and now rand 500. If you
choose FALSE here, you can end up with the results of 500 new
and 500 old simulations.</p></dd>


<dt id="arg-create-dirs">create.dirs<a class="anchor" aria-label="anchor" href="#arg-create-dirs"></a></dt>
<dd><p>If the directories specified in dir.sims and
dir.res do not exists, should it be created? Default is TRUE.</p></dd>


<dt id="arg-dir-psn">dir.psn<a class="anchor" aria-label="anchor" href="#arg-dir-psn"></a></dt>
<dd><p>The directory in which to find PSN's executables
('execute' and 'update_inits'). The default is to rely on the
system's search path. So if you can run 'execute' and
'update_inits' by just typing that in a terminal, you don't
need to specify this unless you want to explicitly use a
specific installation of PSN on your system.</p></dd>


<dt id="arg-args-psn-execute">args.psn.execute<a class="anchor" aria-label="anchor" href="#arg-args-psn-execute"></a></dt>
<dd><p>A charachter string that will be passed as
arguments PSN's `execute`.</p></dd>


<dt id="arg-args-nmscandata">args.NMscanData<a class="anchor" aria-label="anchor" href="#arg-args-nmscandata"></a></dt>
<dd><p>If <code>table.options</code> is used, NMsim
turns to `NMdata::NMscanData()` for a general method to read
the output tables. Use `args.NMscanData` to pass additional
arguments (in a list) to that function if you want the results
to be read in a specific way. This can be if the model for
some reason drops rows, and you need to merge by a row
identifier. You would do `args.NMscanData=list(col.row="ROW")`
to merge by a column called `ROW`. This is only used in rare
cases. Better just stick to NMsim's optimized default
`table.options` and related methods for reading results.</p></dd>


<dt id="arg-as-fun">as.fun<a class="anchor" aria-label="anchor" href="#arg-as-fun"></a></dt>
<dd><p>The default is to return data as a data.frame. Pass
a function (say `tibble::as_tibble`) in as.fun to convert to
something else. If data.tables are wanted, use
as.fun="data.table". The default can be configured using
NMdataConf.</p></dd>


<dt id="arg-system-type">system.type<a class="anchor" aria-label="anchor" href="#arg-system-type"></a></dt>
<dd><p>A charachter string, either \"windows\" or
\"linux\" - case insensitive. Windows is only experimentally
supported. Default is to use <code>Sys.info()[["sysname"]]</code>.</p></dd>


<dt id="arg-dir-sims">dir.sims<a class="anchor" aria-label="anchor" href="#arg-dir-sims"></a></dt>
<dd><p>The directory in which NMsim will store all
generated files. Default is to create a folder called `NMsim`
next to `file.mod`.</p></dd>


<dt id="arg-dir-res">dir.res<a class="anchor" aria-label="anchor" href="#arg-dir-res"></a></dt>
<dd><p>Provide a path to a directory in which to save rds
files with paths to results. Default is to use dir.sims. After
running `NMreadSim()` on these files, the original simulation
files can be deleted. Hence, providing both `dir.sims` and
`dir.res` provides a structure that is simple to
clean. `dir.sims` can be purged when `NMreadSim` has been run
and only small `rds` and `fst` files will be kept in
`dir.res`. Notice, in case multiple models are simulated,
multiple `rds` (to be read with `NMreadSim()`) files will be
created by default. In cases where multiple models are
simulated, see `file.res` to get just one file refering to all
simulation results.</p></dd>


<dt id="arg-file-res">file.res<a class="anchor" aria-label="anchor" href="#arg-file-res"></a></dt>
<dd><p>Path to an rds file that will contain a table of
the simulated models and other metadata. This is needed for
subsequently retrieving all the results using
`NMreadSim()`. The default is to create a file called
`NMsim_..._MetaData.rds` under the <code>dir.res</code> directory
where ... is based on the model name. However, if multiple
models (<code>file.mod</code>) are simulated, this will result in
multiple rds files. Specifying a path ensures that one rds
file containing information about all simulated models will be
created. Notice if <code>file.res</code> is supplied, <code>dir.res</code>
is not used.</p></dd>


<dt id="arg-wait">wait<a class="anchor" aria-label="anchor" href="#arg-wait"></a></dt>
<dd><p>Wait for simulations to finish? Default is to do so if
simulations are run locally but not to if they are sent to the
cluster. Waiting for them means that the results will be read
when simulations are done. If not waiting, path(s) to `rds`
files to read will be returned. Pass them through
`NMreadSim()`. Conveniently, NMreadSim() also takes the `wait` argument too, allowing flexibility to run Nonmem in the background, and then read the results, still waiting for Nonmem to finish.</p></dd>


<dt id="arg-text-sim">text.sim<a class="anchor" aria-label="anchor" href="#arg-text-sim"></a></dt>
<dd><p>A character string to be pasted into
$SIMULATION. This must not contain seed or SUBPROBLEM which
are handled separately. Default is to include "ONLYSIM". You
cannot avoid that using `text.sim`. Instead, you can use
`onlysim=FALSE` which will be passed to `NMsim_default()`.</p></dd>


<dt id="arg-auto-dv">auto.dv<a class="anchor" aria-label="anchor" href="#arg-auto-dv"></a></dt>
<dd><p>Add a column called `DV` to input data sets if a
column of that name is not found? Nonmem is generally
dependent on a `DV` column in input data but this is typically
uninformative in simulation data sets and hence easily
forgotten when generating simulation data sets. If
<code>auto.dv=TRUE</code> and no `DV` column is found, `DV=NA` will
be added. In this case (`auto.dv=TRUE` and no `DV` column
found) a `MDV=1` column will also be added if none found.</p></dd>


<dt id="arg-clean">clean<a class="anchor" aria-label="anchor" href="#arg-clean"></a></dt>
<dd><p>The degree of cleaning (file removal) to do after
Nonmem execution. If `method.execute=="psn"`, this is passed
to PSN's `execute`. If `method.execute=="nmsim"` a similar
behavior is applied, even though not as granular. NMsim's
internal method only distinguishes between 0 (no cleaning),
any integer 1-4 (default, quite a bit of cleaning) and 5
(remove temporary dir completely).</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>If TRUE, messages from what is going on will be
suppressed.</p></dd>


<dt id="arg-nmquiet">nmquiet<a class="anchor" aria-label="anchor" href="#arg-nmquiet"></a></dt>
<dd><p>Silent console messages from Nonmem? The default
behaviour depends. It is FALSE if there is only one model to
execute and `progress=FALSE`.</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Track progress? Default is `TRUE` if `quiet` is
FALSE and more than one model is being simulated. The progress
tracking is based on the number of models completed, not the
status of the individual models.</p></dd>


<dt id="arg-check-mod">check.mod<a class="anchor" aria-label="anchor" href="#arg-check-mod"></a></dt>
<dd><p>Check the provided control streams for contents
that may cause issues for simulation. Default is `TRUE`, and
it is only recommended to disable this if you are fully aware
of such a feature of your control stream, you know how it
impacts simulation, and you want to get rid of warnings.</p></dd>


<dt id="arg-format-data-complete">format.data.complete<a class="anchor" aria-label="anchor" href="#arg-format-data-complete"></a></dt>
<dd><p>For development purposes - users do
not need this argument. Controls what format the complete
input data set is saved in.  Possible values are `rds`
(default), `fst` (experimental) and `csv`. `fst` may be faster
and use less disk space but factor levels may be lost from
input data to output data. `csv` will also lead to loss of
additional information such as factor levels.</p></dd>


<dt id="arg-text-table">text.table<a class="anchor" aria-label="anchor" href="#arg-text-table"></a></dt>
<dd><p>Deprecated. Use `table.vars` and `table.options`
instead.</p></dd>


<dt id="arg-suffix-sim">suffix.sim<a class="anchor" aria-label="anchor" href="#arg-suffix-sim"></a></dt>
<dd><p>Deprecated. Use name.sim instead.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Deprecated. See <code>seed.R</code> and <code>seed.nm</code>.</p></dd>


<dt id="arg-file-ext">file.ext<a class="anchor" aria-label="anchor" href="#arg-file-ext"></a></dt>
<dd><p>Depecated. Use
`inits=list(file.ext="path/to/file.ext")` instead. Optionally
provide a parameter estimate file from Nonmem. This is
normally not needed since `NMsim` will by default use the ext
file stored next to the input control stream (replacing the
file name extension with `.ext`). If using
method.update.inits="psn", this argument cannot be used.</p></dd>


<dt id="arg-method-update-inits">method.update.inits<a class="anchor" aria-label="anchor" href="#arg-method-update-inits"></a></dt>
<dd><p>Deprecated, please migrate to `inits`
instead. The initial values of all parameters are by updated
from the estimated model before running the simulation. NMsim
can do this with a native function or use PSN to do it - or
the step can be skipped to not update the values.</p></dd>


<dt id="arg-modify-model">modify.model<a class="anchor" aria-label="anchor" href="#arg-modify-model"></a></dt>
<dd><p>Deprecated. Use modify instead.</p></dd>


<dt id="arg-list-sections">list.sections<a class="anchor" aria-label="anchor" href="#arg-list-sections"></a></dt>
<dd><p>Deprecated. Use modify instead.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code>method.sim</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.frame with simulation results (same number of rows
    as input data). If `sge=TRUE` a character vector with paths to
    simulation control streams.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Loosely speaking, the argument <code>method.sim</code> defines
    _what_ NMsim will do, <code>method.execute</code> define _how_ it
    does it. <code>method.sim</code> takes a function that converts an
    estimation control stream into whatever should be
    run. Features like replacing `$INPUT`, `$DATA`, `$TABLE`, and
    handling seeds are NMsim features that are done in addition to
    the <code>method.sim</code>. Also the <code>modeify.model</code> argument
    is handled in addition to the <code>method.sim</code>. The
    <code>subproblems</code> and <code>seed.nm</code> arguments are available
    to all methods creating a <code>$SIMULATION</code> section.</p>
<p>Notice, the following functions are internally available to
`NMsim` so you can run them by say <code>method.sim=NMsim_EBE</code>
without quotes. To see the code of that method, type
<code>NMsim_EBE</code>.</p>
<ul><li><p><code>NMsim_default</code> The default behaviour. Replaces any
$ESTIMATION and $COVARIANCE sections by a $SIMULATION section.</p></li>
<li><p><code>NMsim_asis</code> The simplest of all method. It does nothing (but
again, <code>NMsim</code> handles `$INPUT`, `$DATA`, `$TABLE` and
more. Use this for instance if you already created a simulation
(or estimation actually) control stream and want NMsim to run it
on different data sets.</p></li>
<li><p><code>NMsim_EBE</code> Simulates _known_ ETAs. By default, the ETA
values are automatically taken from the estimation run. This is
what is refered to as emperical Bayes estimates, hence the name of
the method "NMsim_EBE". However, the user can also provide a
different `.phi` file which may contain simulated ETA values (see
the `file.phi` argument). ID values in the simulation data set
must match ID values in the phi file for this step to work. If
refering to estimated subjects, the .phi file from the estimation
run must be found next to the .lst file from the estimation with
the same file name stem (say `run1.lst` and `run1.phi`). Again, ID
values in the (simulation) input data must be ID values that were
used in the estimation too. The method Runs an <code>$ESTIMATION
MAXEVAL=0</code> but pulls in ETAs for the ID's found in data. No
<code>$SIMULATION</code> step is run which unfortunately means no
residual error will be simulated.</p></li>
<li><p><code>NMsim_VarCov</code> Like <code>NMsim_default</code> but `$THETA`,
`$OMEGA`, and `SIGMA` are drawn from distribution estimated in
covariance step. This means that a successful covariance step must
be available from the estimation. NB. A multivariate normal
distribution is used for all parameters, including `$OMEGA` and
`$SIGMA` which is not the correct way to do this. In case the
simulation leads to negative diagonal elements in $OMEGA and
$SIGMA, those values are truncated at zero. This method is only
valid for simulation of `$THETA` variability. The method accepts a
table of parameter values that can be produced with other tools
than `NMsim`. For simulation with parameter variability based on
bootstrap results, use <code>NMsim_default</code>.</p></li>
<li><p><code>NMsim_typical</code> Deprecated. Use <code>typical=TRUE</code> instead.</p></li>
</ul></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Philip Delff.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>



  <script data-goatcounter="https://nmsim.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>

